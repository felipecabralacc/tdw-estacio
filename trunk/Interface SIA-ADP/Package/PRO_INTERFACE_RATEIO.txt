  PROCEDURE PRO_INTERFACE_RATEIO(PI_DT_COMPETENCIA  IN DATE
                                ,PI_NOM_PROCESSO    IN VARCHAR2
                                ,PI_COMMIT          IN VARCHAR2
                                ,PI_COD_INSTITUICAO IN NUMBER
                                ,PO_IND_ERRO        OUT VARCHAR2
                                ,PO_MSG_RETORNO     OUT VARCHAR2) IS
    --
    ERR_PREVISTO EXCEPTION;
    --
    V_POSICAO        PLS_INTEGER;
    V_TXT_PARAMETROS VARCHAR2(4000);
    V_SQLERRM        VARCHAR2(4000);
    --
    VQTD_LINHAS_INCLUIDAS NUMBER(10) := 0;
    --
    CURSOR C_AP IS
      SELECT IP.NUM_SEQ_MOVIMENTO
            ,IP.DT_MES_ANO_COMPETENCIA
            ,IP.CICLO
            ,IP.NOM_PROCESSO
            ,IP.IND_SITUACAO_PAGAMENTO
            ,IP.IND_DESTINO
            ,IP.IND_CURSO_EXTENSAO
            ,IP.COD_PROFESSOR
            ,IP.NUM_MATRICULA
            ,IP.COD_TIPO_CURSO
            ,IP.COD_CURSO
            ,IP.COD_CURSO_EXTENSAO
            ,IP.COD_CAMPUS
            ,IP.COD_TURNO
            ,IP.COD_TIPO_RUBRICA
            ,IP.QTD_HORAS_MOVIMENTO
            ,IP.VALOR_MOVIMENTO
            ,IP.DT_GERACAO
            ,IP.DT_LIBERACAO
            ,IP.DT_PROCESSAMENTO
            ,IP.NUM_SEQ_SOLICITACAO
            ,IP.NUM_SEQ_ALOCACAO
            ,IP.NUM_SEQ_ATUACAO
            ,IP.MES_ANO_ATUACAO
            ,IP.NUM_SEQ_FALTA
            ,IP.PERCENTUAL_APRIMORAMENTO
            ,IP.COD_BANCO
            ,IP.COD_AGENCIA
            ,IP.COD_AGENCIA_DV
            ,IP.COD_CONTA_CORRENTE
            ,IP.COD_CONTA_CORRENTE_DV
            ,IP.COD_CATEGORIA_PROFESSOR
            ,IP.NUM_SEQ_TURMA
            ,IP.COD_TURMA_EXTENSAO
            ,IP.COD_VERBA_RH
            ,IP.IND_TIPO_CONTRATO
            ,IP.COD_CENTRO_RESULTADO
            ,IP.COD_TIPO_ATUACAO
            ,IP.QTD_HORAS_TRABALHADAS
            ,T.IND_ENSINO_DISTANCIA
        FROM SIA.CONTROLE_PAGAMENTO_PROFESSOR CPP
            ,SIA.INTERFACE_PAGAMENTO          IP
            ,SIA.TURMA                        T
       WHERE CPP.DT_MES_ANO_COMPETENCIA BETWEEN TRUNC(PI_DT_COMPETENCIA) AND TRUNC(PI_DT_COMPETENCIA) + 1
         AND CPP.DT_EXPORTACAO_OK IS NOT NULL -- CICLO VÁLIDO
         AND CPP.NOM_PROCESSO = PI_NOM_PROCESSO -- CARGA HORARIA
         AND IP.NOM_PROCESSO = CPP.NOM_PROCESSO
         AND IP.DT_MES_ANO_COMPETENCIA = CPP.DT_MES_ANO_COMPETENCIA
         AND IP.CICLO = CPP.CICLO
         AND IP.COD_INSTITUICAO = CPP.COD_INSTITUICAO
         AND IP.IND_CURSO_EXTENSAO <> 'S'
         AND T.NUM_SEQ_TURMA = IP.NUM_SEQ_TURMA
         AND CPP.COD_INSTITUICAO = PI_COD_INSTITUICAO
       ORDER BY NUM_SEQ_MOVIMENTO;
    --
    R_AP C_AP%ROWTYPE;
    --
  BEGIN
    --
    PO_IND_ERRO    := '0';
    PO_MSG_RETORNO := '';
    --
    -- 1. INICIALIZACAO
    --
    V_POSICAO := 10;
    --
    V_TXT_PARAMETROS := ' PI_DT_COMPETENCIA  : ' || PI_DT_COMPETENCIA || CHR(13) || ' PI_NOM_PROCESSO    : ' || PI_NOM_PROCESSO;
    --
    OPEN C_AP;
    FETCH C_AP
      INTO R_AP;
    --
    IF C_AP%NOTFOUND
    THEN
      PO_MSG_RETORNO := 'NENHUMA INFORMAÇÃO FOI ENCONTRADA PARA O PERÍODO ' || TO_CHAR(PI_DT_COMPETENCIA, 'MM/YYYY') || ' NO PROCESSO DE CARGA HORÁRIA. DO CICLO.';
      RETURN;
    END IF;
    --
    LOOP
      --
      -- 1.6. CARREGA AS LINHAS NO REGISTRO ANTERIOR (R_AP_ANT)
      --
      V_POSICAO := 16;
      --
      EXIT WHEN C_AP%NOTFOUND;
      --
      PRO_GERA_RATEIO(R_AP.CICLO, R_AP.DT_MES_ANO_COMPETENCIA, R_AP.NOM_PROCESSO, R_AP.NUM_SEQ_TURMA, R_AP.NUM_MATRICULA, R_AP.COD_TIPO_RUBRICA, R_AP.IND_CURSO_EXTENSAO, R_AP.IND_ENSINO_DISTANCIA, R_AP.COD_TIPO_ATUACAO, PI_COD_INSTITUICAO, PO_IND_ERRO, PO_MSG_RETORNO);
      --
      IF PO_IND_ERRO <> '0'
      THEN
        RAISE ERR_PREVISTO;
      END IF;
      --
      VQTD_LINHAS_INCLUIDAS := VQTD_LINHAS_INCLUIDAS + 1;
      --
      IF PI_COMMIT = 'S' AND
         MOD(VQTD_LINHAS_INCLUIDAS, 1000) = 0
      THEN
        COMMIT;
      END IF;
      --
      FETCH C_AP
        INTO R_AP;
      --
    END LOOP; -- LOOP
    --
  EXCEPTION
    WHEN ERR_PREVISTO THEN
      --
      V_SQLERRM := SQLERRM;
      --
      PO_IND_ERRO := TO_CHAR(V_POSICAO * -1);
      --
      CASE PO_IND_ERRO
        WHEN '-20' THEN
          PO_MSG_RETORNO := 'ERRO AO LIMPAR TODAS AS LINHAS DAS TABELAS : ' || PO_MSG_RETORNO;
        ELSE
          PO_MSG_RETORNO := PO_MSG_RETORNO || ' - ERRO N O LISTADO : ' || V_SQLERRM;
      END CASE;
    --
      SEG.SEG_LOG_EXECUCAO('SIA.PRO_PAGAMENTO_PROFESSOR.PRO_INTERFACE_RATEIO, IE: ' || PI_COD_INSTITUICAO, V_POSICAO, V_SQLERRM, V_TXT_PARAMETROS, PO_MSG_RETORNO);
      --
      IF PI_COMMIT = 'S'
      THEN
        ROLLBACK;
      END IF;
      --
    WHEN OTHERS THEN
      --
      V_SQLERRM := SQLERRM;
      --
      PO_IND_ERRO := TO_CHAR(V_POSICAO * -1);
      --
      CASE PO_IND_ERRO
        WHEN '-20' THEN
          PO_MSG_RETORNO := 'ERRO NA BUSCAR DO C DIGO DA VERBA DO RH : ' || V_SQLERRM;
        ELSE
          PO_MSG_RETORNO := 'ERRO N O LISTADO : ' || V_SQLERRM;
      END CASE;
    --
      SEG.SEG_LOG_EXECUCAO('SIA.PRO_PAGAMENTO_PROFESSOR.PRO_INTERFACE_RATEIO, IE: ' || PI_COD_INSTITUICAO, V_POSICAO, V_SQLERRM, V_TXT_PARAMETROS, PO_MSG_RETORNO);
      --
      IF PI_COMMIT = 'S'
      THEN
        ROLLBACK;
      END IF;
      --
  END PRO_INTERFACE_RATEIO;