FLuxo 3 - Apuracao Alocaçao - inicia na linha 713 finaliza na linha 800
Pagamento Proporcional

 IF T_TURMA(I).QTD_DIA_TRABALHADO >= 30 OR (TO_CHAR(P_DT_COMPETENCIA, 'MM') = 2 AND TO_CHAR(LAST_DAY(P_DT_COMPETENCIA), 'DD') = T_TURMA(I).QTD_DIA_TRABALHADO) THEN

 Fluxo 1
 Fluxo 2

Else
CALCULA QTD DE A PAGAR. PROPORCIONAL
                            V_QTD_DIAS_DIF := 0;
                            --
                            -- SE O MÊS DA DATA INICIAL FOR FEVEREIRO E
                            -- SE FOR DO MESMO ANO DE COMPETENCIA E
                            -- SE A DATA FINAL EXTRAPOLAR O MES DE COMPETENCIA ENTÃO CALCULA A DIFERENÇA PARA 30 DIAS
                            --
                            IF TO_CHAR(T_TURMA(I).DT_INI_ALOCACAO, 'MM') = '02' AND
                               TO_CHAR(T_TURMA(I).DT_INI_ALOCACAO, 'YYYY') = TO_CHAR(P_DT_COMPETENCIA, 'YYYY') AND
                               T_TURMA(I).DT_FIM_ALOCACAO >= LAST_DAY(P_DT_COMPETENCIA)
                            THEN
                              V_QTD_DIAS_DIF := 30 - TO_NUMBER(TO_CHAR(LAST_DAY(T_TURMA(I).DT_INI_ALOCACAO), 'DD'));
                            END IF;
                            --
                            T_TURMA(I).QTD_DIA_TRABALHADO := T_TURMA(I).QTD_DIA_TRABALHADO + V_QTD_DIAS_DIF;
                            --
                            IF T_TURMA(I).QTD_DIA_TRABALHADO > 30
                            THEN
                              T_TURMA(I).QTD_DIA_TRABALHADO := 30;
                            END IF;
                            --
                            V_QTD_CARGA_MENSAL := (T_TURMA(I).QTD_DIA_TRABALHADO * 0.15) * T_TURMA(I).VAL_HORA_AULA;
                            --
                            -- 3.1. ATUALIZA A_INTERFACE_PAGAMENTO P/ CALCULA QTD DE A PAGAR. PROPORCIONAL
                            --
                            V_POSICAO := 33;
                            --
                            SELECT DECODE(T_TURMA(I).TABELA, 'HTE', NULL, T_TURMA(I).COD_CURSO)
                                  ,DECODE(T_TURMA(I).TABELA, 'HTE', T_TURMA(I).COD_CURSO, NULL)
                                  ,DECODE(T_TURMA(I).TABELA, 'HTE', NULL, T_TURMA(I).NUM_SEQ_TURMA)
                                  ,DECODE(T_TURMA(I).TABELA, 'HTE', T_TURMA(I).NUM_SEQ_TURMA, NULL)
                                  ,DECODE(V_COD_TIPO_RUBRICA, 1, V_QTD_CARGA_MENSAL, 42, V_QTD_CARGA_MENSAL, 43, V_QTD_CARGA_MENSAL, V_QTD_CARGA_MENSAL_AD_NOT)
                              INTO V_COD_CURSO
                                  ,V_COD_CURSO_EXTENSAO
                                  ,V_NUM_SEQ_TURMA
                                  ,V_COD_TURMA_EXTENSAO
                                  ,V_QTDE_HORAS_MOVIMENTO
                              FROM DUAL;
                            --
                            GRAVA_ARQUIVO(V_COD_TIPO_RUBRICA                       -- PI_COD_TIPO_RUBRICA
                                         , P_DT_COMPETENCIA                        -- PI_DT_COMPETENCIA           (V_DT_COMPETENCIA)
                                         , V_PROXIMO_CICLO                         -- PI_PROXIMO_CICLO
                                         , 'PRO_APURACAO_ALOCACAO'                 -- PI_NOM_PROCESSO
                                         , '1'                                     -- PI_IND_SITUACAO_PAGAMENTO   (1=GERADO)
                                         , V_DESTINO                               -- PI_IND_DESTINO
                                         , V_CURSO_EXTENSAO                        -- PI_IND_CURSO_EXTENSAO
                                         , T_TURMA(I).COD_PROFESSOR                -- PI_COD_PROFESSOR
                                         , T_TURMA(I).NUM_MATRICULA                -- PI_NUM_MATRICULA
                                         , T_TURMA(I).COD_TIPO_CURSO               -- PI_COD_TIPO_CURSO
                                         , V_COD_CURSO                             -- PI_COD_CURSO
                                         , V_COD_CURSO_EXTENSAO                    -- PI_COD_CURSO_EXTENSAO
                                         , T_TURMA(I).COD_CAMPUS                   -- PI_COD_CAMPUS
                                         , T_TURMA(I).COD_TURNO                    -- PI_COD_TURNO
                                         , V_QTDE_HORAS_MOVIMENTO                  -- PI_QTD_HORAS_MOVIMENTO
                                         , NULL                                    -- PI_VALOR_MOVIMENTO
                                         , SYSDATE                                 -- PI_DT_GERACAO
                                         , NULL                                    -- PI_DT_LIBERACAO
                                         , NULL                                    -- PI_DT_PROCESSAMENTO
                                         , NULL                                    -- PI_NUM_SEQ_SOLICITACAO
                                         , T_TURMA(I).NUM_SEQ_ALOCACAO             -- PI_NUM_SEQ_ALOCACAO
                                         , NULL                                    -- PI_NUM_SEQ_ATUACAO
                                         , NULL                                    -- PI_MES_ANO_ATUACAO
                                         , NULL                                    -- PI_NUM_SEQ_FALTA
                                         , T_TURMA(I).APRIMORAMENTO                -- PI_PERCENTUAL_APRIMORAMENTO
                                         , T_TURMA(I).COD_BANCO                    -- PI_COD_BANCO
                                         , T_TURMA(I).COD_AGENCIA                  -- PI_COD_AGENCIA
                                         , T_TURMA(I).COD_AGENCIA_DV               -- PI_COD_AGENCIA_DV
                                         , T_TURMA(I).CONTA_CORRENTE               -- PI_COD_CONTA_CORRENTE
                                         , T_TURMA(I).CONTA_CORRENTE_DV            -- PI_COD_CONTA_CORRENTE_DV
                                         , T_TURMA(I).COD_CATEGORIA_PROFESSOR      -- PI_COD_CATEGORIA_PROFESSOR
                                         , V_NUM_SEQ_TURMA                         -- PI_NUM_SEQ_TURMA
                                         , V_COD_TURMA_EXTENSAO                    -- PI_COD_TURMA_EXTENSAO
                                         , T_TURMA(I).IND_TIPO_CONTRATO            -- PI_IND_TIPO_CONTRATO
                                         , P_COD_INSTITUICAO                       -- PI_COD_INSTITUICAO
                                         , 'N'                                     -- PI_COMMIT
                                         , P_IND_ERRO                              -- PO_IND_ERRO
                                         , P_MSG_RETORNO                           -- PO_MSG_RETORNO
                                         , NULL                                    -- PI_COD_TIPO_ATUACAO
                                         , V_QTDE_HORAS_MOVIMENTO                  -- PI_QTD_HORAS_TRABALHADAS -> REQ. 4893 - CÁLCULO DE HORAS TRABALHADAS
                                         , 'N'                                     -- PI_IND_ENSINO_DISTANCIA
                                         , T_TURMA(I).QTD_DIA_TRABALHADO           -- PI_QTD_DIAS_TRABALHADOS
                                         , NULL);                                  -- PI_QTD_HORAS_TEORICO
                            --
                            IF P_IND_ERRO <> '0'  THEN
                              RAISE_APPLICATION_ERROR(-20010, P_IND_ERRO || ' - ' || P_MSG_RETORNO);
                            END IF;
                            --
                            V_QTD_REG_GRAVADOS := V_QTD_REG_GRAVADOS + 1;