PROCEDURE GRAVA_ARQUIVO(PI_COD_TIPO_RUBRICA         IN SIA.A_INTERFACE_PAGAMENTO.COD_TIPO_RUBRICA%TYPE
                         ,PI_DT_COMPETENCIA           IN SIA.A_INTERFACE_PAGAMENTO.DT_MES_ANO_COMPETENCIA%TYPE
                         ,PI_PROXIMO_CICLO            IN SIA.A_INTERFACE_PAGAMENTO.CICLO%TYPE
                         ,PI_NOM_PROCESSO             IN SIA.A_INTERFACE_PAGAMENTO.NOM_PROCESSO%TYPE
                         ,PI_IND_SITUACAO_PAGAMENTO   IN SIA.A_INTERFACE_PAGAMENTO.IND_SITUACAO_PAGAMENTO%TYPE
                         ,PI_IND_DESTINO              IN SIA.A_INTERFACE_PAGAMENTO.IND_DESTINO%TYPE
                         ,PI_IND_CURSO_EXTENSAO       IN SIA.A_INTERFACE_PAGAMENTO.IND_CURSO_EXTENSAO%TYPE
                         ,PI_COD_PROFESSOR            IN SIA.A_INTERFACE_PAGAMENTO.COD_PROFESSOR%TYPE
                         ,PI_NUM_MATRICULA            IN SIA.A_INTERFACE_PAGAMENTO.NUM_MATRICULA%TYPE
                         ,PI_COD_TIPO_CURSO           IN SIA.A_INTERFACE_PAGAMENTO.COD_TIPO_CURSO%TYPE
                         ,PI_COD_CURSO                IN SIA.A_INTERFACE_PAGAMENTO.COD_CURSO%TYPE
                         ,PI_COD_CURSO_EXTENSAO       IN SIA.A_INTERFACE_PAGAMENTO.COD_CURSO_EXTENSAO%TYPE
                         ,PI_COD_CAMPUS               IN SIA.A_INTERFACE_PAGAMENTO.COD_CAMPUS%TYPE
                         ,PI_COD_TURNO                IN SIA.A_INTERFACE_PAGAMENTO.COD_TURNO%TYPE
                         ,PI_QTD_HORAS_MOVIMENTO      IN SIA.A_INTERFACE_PAGAMENTO.QTD_HORAS_MOVIMENTO%TYPE
                         ,PI_VALOR_MOVIMENTO          IN SIA.A_INTERFACE_PAGAMENTO.VALOR_MOVIMENTO%TYPE
                         ,PI_DT_GERACAO               IN SIA.A_INTERFACE_PAGAMENTO.DT_GERACAO%TYPE
                         ,PI_DT_LIBERACAO             IN SIA.A_INTERFACE_PAGAMENTO.DT_LIBERACAO%TYPE
                         ,PI_DT_PROCESSAMENTO         IN SIA.A_INTERFACE_PAGAMENTO.DT_PROCESSAMENTO%TYPE
                         ,PI_NUM_SEQ_SOLICITACAO      IN SIA.A_INTERFACE_PAGAMENTO.NUM_SEQ_SOLICITACAO%TYPE
                         ,PI_NUM_SEQ_ALOCACAO         IN SIA.A_INTERFACE_PAGAMENTO.NUM_SEQ_ALOCACAO%TYPE
                         ,PI_NUM_SEQ_ATUACAO          IN SIA.A_INTERFACE_PAGAMENTO.NUM_SEQ_ATUACAO%TYPE
                         ,PI_MES_ANO_ATUACAO          IN SIA.A_INTERFACE_PAGAMENTO.MES_ANO_ATUACAO%TYPE
                         ,PI_NUM_SEQ_FALTA            IN SIA.A_INTERFACE_PAGAMENTO.NUM_SEQ_FALTA%TYPE
                         ,PI_PERCENTUAL_APRIMORAMENTO IN SIA.A_INTERFACE_PAGAMENTO.PERCENTUAL_APRIMORAMENTO%TYPE
                         ,PI_COD_BANCO                IN SIA.A_INTERFACE_PAGAMENTO.COD_BANCO%TYPE
                         ,PI_COD_AGENCIA              IN SIA.A_INTERFACE_PAGAMENTO.COD_AGENCIA%TYPE
                         ,PI_COD_AGENCIA_DV           IN SIA.A_INTERFACE_PAGAMENTO.COD_AGENCIA_DV%TYPE
                         ,PI_COD_CONTA_CORRENTE       IN SIA.A_INTERFACE_PAGAMENTO.COD_CONTA_CORRENTE%TYPE
                         ,PI_COD_CONTA_CORRENTE_DV    IN SIA.A_INTERFACE_PAGAMENTO.COD_CONTA_CORRENTE_DV%TYPE
                         ,PI_COD_CATEGORIA_PROFESSOR  IN SIA.A_INTERFACE_PAGAMENTO.COD_CATEGORIA_PROFESSOR%TYPE
                         ,PI_NUM_SEQ_TURMA            IN SIA.A_INTERFACE_PAGAMENTO.NUM_SEQ_TURMA%TYPE
                         ,PI_COD_TURMA_EXTENSAO       IN SIA.A_INTERFACE_PAGAMENTO.COD_TURMA_EXTENSAO%TYPE
                         ,PI_IND_TIPO_CONTRATO        IN SIA.A_INTERFACE_PAGAMENTO.IND_TIPO_CONTRATO%TYPE
                         ,PI_COD_INSTITUICAO          IN SIA.INSTITUICAO_ENSINO.COD_INSTITUICAO%TYPE
                         ,PI_COMMIT                   IN VARCHAR2 DEFAULT 'N'
                         ,PO_IND_ERRO                 OUT VARCHAR2
                         ,PO_MSG_RETORNO              OUT VARCHAR2
                         ,PI_COD_TIPO_ATUACAO         IN SIA.A_INTERFACE_PAGAMENTO.COD_TIPO_ATUACAO%TYPE DEFAULT NULL
                         ,PI_QTD_HORAS_TRABALHADAS    IN SIA.A_INTERFACE_PAGAMENTO.QTD_HORAS_TRABALHADAS%TYPE DEFAULT NULL
                         ,PI_IND_ENSINO_DISTANCIA     IN SIA.TURMA.IND_ENSINO_DISTANCIA%TYPE DEFAULT 'N'
                         ,PI_QTD_DIAS_TRABALHADOS     IN SIA.INTERFACE_PAGAMENTO.QTD_DIAS_TRABALHADOS%TYPE DEFAULT NULL
                         ,PI_QTD_HORAS_TEORICO        IN SIA.TURMA.QTD_HORAS_TEORICO%TYPE DEFAULT NULL) IS
    --
    ERR_PREVISTO EXCEPTION;
    --
    V_POSICAO              PLS_INTEGER;
    V_TXT_PARAMETROS       VARCHAR2(4000);
    V_SQLERRM              VARCHAR2(4000);
    V_COD_VERBA_RH         SIA.A_INTERFACE_PAGAMENTO.COD_VERBA_RH%TYPE;
    V_COD_CENTRO_RESULTADO SIA.A_INTERFACE_PAGAMENTO.COD_CENTRO_RESULTADO%TYPE;
    --
    V_QTD_HORAS_MOVIMENTO   SIA.A_INTERFACE_PAGAMENTO.QTD_HORAS_MOVIMENTO%TYPE;
    V_QTD_HORAS_TRABALHADAS SIA.A_INTERFACE_PAGAMENTO.QTD_HORAS_TRABALHADAS%TYPE;
    --
  BEGIN
    --
    -- 1. INICIALIZACAO
    --
    V_POSICAO := 10;
    --
    V_TXT_PARAMETROS := ' PI_NUM_SEQ_TURMA   : ' || PI_NUM_SEQ_TURMA || CHR(13) || ' PI_COD_TURMA_EXTENSAO    : ' || PI_COD_TURMA_EXTENSAO || CHR(13) || ' P_COD_PROFESSOR    : ' || PI_COD_PROFESSOR || CHR(13) || ' PI_NOM_PROCESSO    : ' || PI_NOM_PROCESSO;
    --
    -- REQ. 5390 - FERNANDO REIS / ANDERSON PINHEIRO - 28/06/2006
    -- N O PERMITIR QUE A CARGA HORARIA ULTRAPASSE 4.5
    --
    V_QTD_HORAS_MOVIMENTO   := PI_QTD_HORAS_MOVIMENTO;
    V_QTD_HORAS_TRABALHADAS := PI_QTD_HORAS_TRABALHADAS;

		-----COMENTADO/ALTERADO EM 03/09/2010 POR CARLOS ABRANTES E MIRIAM POIS ESTAVA PAGANDO FIXO PARA TODOS OS
		--PROFESSORES O VALOR DA CARGA HORÁRIA DE 4.5
  /*  IF PI_NOM_PROCESSO IN ('PRO_APURACAO_ALOCACAO','PRO_RETROATIVO_ALOCACAO') THEN
      --
      IF PI_COD_TIPO_RUBRICA = 1 AND V_QTD_HORAS_MOVIMENTO > 4.5 THEN
        V_QTD_HORAS_MOVIMENTO := 4.5;
      ELSIF PI_COD_TIPO_RUBRICA = 2 AND V_QTD_HORAS_MOVIMENTO > 3 THEN
        V_QTD_HORAS_MOVIMENTO := 3;
      END IF;
      --
      IF PI_COD_TIPO_RUBRICA = 1 AND V_QTD_HORAS_TRABALHADAS > 4.5 THEN
        V_QTD_HORAS_TRABALHADAS := 4.5;
      END IF;
      --
    END IF;
    */

    -- 2. BUSCA O CODIGO DA VERBA DO RH
    --
    V_POSICAO := 20;
    --
    -- 2.1. OBTEM A VERBA DO RH DA ATUAÇÃO QUE POSSUI INDICAÇÃO DIRETA DE RUBRICA DE PAGAMENTO.
    --
    V_COD_VERBA_RH := NULL;
    --
    IF PI_COD_TIPO_ATUACAO IS NOT NULL THEN
     BEGIN
       --
       SELECT CASE PI_IND_TIPO_CONTRATO WHEN 'F' THEN
                 RI.COD_VERBA_RH
                WHEN 'S' THEN
								 RI.COD_VERBA_PRESTADOR
                ELSE
                 RI.COD_VERBA_PESSOA_JURIDICA
              END
         INTO V_COD_VERBA_RH
         FROM SIA.TIPO_ATUACAO TA
             ,SIA.RUBRICA_INTERFACE RI
        WHERE TA.COD_TIPO_RUBRICA = RI.COD_TIPO_RUBRICA
          AND TA.COD_TIPO_ATUACAO = PI_COD_TIPO_ATUACAO;
       --
       EXCEPTION
       WHEN NO_DATA_FOUND THEN
           V_COD_VERBA_RH := NULL;
           RAISE ERR_PREVISTO;
       END;
       --
    END IF;
    --
    -- 2.2. OBTEM A VERBA DO RH ATRAVÉS DA ROTINA PRO_OBTEM_VERBA_RH.
    --
    -- SRD - 1436-Pagamento de Graduacao EAD
    IF PI_IND_ENSINO_DISTANCIA = 'S' AND PI_QTD_HORAS_TEORICO <= 59 THEN
      V_COD_VERBA_RH := V_TXT_PARAM_VRB_ATE59;
    ELSIF PI_IND_ENSINO_DISTANCIA = 'S' AND PI_QTD_HORAS_TEORICO >= 60 THEN
      V_COD_VERBA_RH := V_TXT_PARAM_VRB_ACIMA59;
    ELSIF V_COD_VERBA_RH IS NULL THEN
      V_COD_VERBA_RH := PRO_OBTEM_VERBA_RH(PI_COD_TIPO_CURSO, PI_COD_CAMPUS, NVL(PI_COD_CURSO, PI_COD_CURSO_EXTENSAO), PI_COD_TURNO, PI_IND_TIPO_CONTRATO, PI_COD_TIPO_RUBRICA, PI_COD_INSTITUICAO);
    END IF;
    --
    -- 3. BUSCA O C DIGO DO CENTRO DE RESULTADO
    --
    V_POSICAO := 30;
    --
    V_COD_CENTRO_RESULTADO := PRO_OBTEM_CENTRO_RESULTADO(PI_COD_TIPO_CURSO, PI_COD_CAMPUS, NVL(PI_COD_CURSO, PI_COD_CURSO_EXTENSAO), PI_COD_TURNO, PI_NOM_PROCESSO, PI_COD_TIPO_ATUACAO, PI_COD_INSTITUICAO);
    --
    -- 4. INSERIR EM A_INTERFACE_PAGAMENTO
    --
    V_POSICAO := 40;
    --
    BEGIN
      --
      INSERT INTO SIA.A_INTERFACE_PAGAMENTO
        (NUM_SEQ_MOVIMENTO
        ,DT_MES_ANO_COMPETENCIA
        ,CICLO
        ,NOM_PROCESSO
        ,IND_SITUACAO_PAGAMENTO
        ,IND_DESTINO
        ,IND_CURSO_EXTENSAO
        ,COD_PROFESSOR
        ,NUM_MATRICULA
        ,COD_TIPO_CURSO
        ,COD_CURSO
        ,COD_CURSO_EXTENSAO
        ,COD_CAMPUS
        ,COD_TURNO
        ,COD_TIPO_RUBRICA
        ,QTD_HORAS_MOVIMENTO
        ,VALOR_MOVIMENTO
        ,DT_GERACAO
        ,DT_LIBERACAO
        ,DT_PROCESSAMENTO
        ,NUM_SEQ_SOLICITACAO
        ,NUM_SEQ_ALOCACAO
        ,NUM_SEQ_ATUACAO
        ,MES_ANO_ATUACAO
        ,NUM_SEQ_FALTA
        ,PERCENTUAL_APRIMORAMENTO
        ,COD_BANCO
        ,COD_AGENCIA
        ,COD_AGENCIA_DV
        ,COD_CONTA_CORRENTE
        ,COD_CONTA_CORRENTE_DV
        ,COD_CATEGORIA_PROFESSOR
        ,NUM_SEQ_TURMA
        ,COD_TURMA_EXTENSAO
        ,COD_VERBA_RH
        ,IND_TIPO_CONTRATO
        ,COD_CENTRO_RESULTADO
        ,COD_TIPO_ATUACAO
        ,QTD_HORAS_TRABALHADAS
        ,COD_INSTITUICAO
        ,QTD_DIAS_TRABALHADOS)
      VALUES
        (SIA.S_INTERFACE_PAGAMENTO.NEXTVAL
        ,PI_DT_COMPETENCIA
        ,PI_PROXIMO_CICLO
        ,PI_NOM_PROCESSO
        ,PI_IND_SITUACAO_PAGAMENTO
        ,PI_IND_DESTINO
        ,PI_IND_CURSO_EXTENSAO
        ,PI_COD_PROFESSOR
        ,PI_NUM_MATRICULA
        ,PI_COD_TIPO_CURSO
        ,PI_COD_CURSO
        ,PI_COD_CURSO_EXTENSAO
        ,PI_COD_CAMPUS
        ,PI_COD_TURNO
        ,PI_COD_TIPO_RUBRICA
        ,V_QTD_HORAS_MOVIMENTO
        ,PI_VALOR_MOVIMENTO
        ,PI_DT_GERACAO
        ,PI_DT_LIBERACAO
        ,PI_DT_PROCESSAMENTO
        ,PI_NUM_SEQ_SOLICITACAO
        ,PI_NUM_SEQ_ALOCACAO
        ,PI_NUM_SEQ_ATUACAO
        ,PI_MES_ANO_ATUACAO
        ,PI_NUM_SEQ_FALTA
        ,PI_PERCENTUAL_APRIMORAMENTO
        ,PI_COD_BANCO
        ,PI_COD_AGENCIA
        ,PI_COD_AGENCIA_DV
        ,PI_COD_CONTA_CORRENTE
        ,PI_COD_CONTA_CORRENTE_DV
        ,PI_COD_CATEGORIA_PROFESSOR
        ,PI_NUM_SEQ_TURMA
        ,PI_COD_TURMA_EXTENSAO
        ,to_char(V_COD_VERBA_RH)
        ,PI_IND_TIPO_CONTRATO
        ,V_COD_CENTRO_RESULTADO
        ,PI_COD_TIPO_ATUACAO
        ,V_QTD_HORAS_TRABALHADAS
        ,PI_COD_INSTITUICAO
        ,PI_QTD_DIAS_TRABALHADOS);
      --
    EXCEPTION
      WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20100, SQLCODE || ' - ' || SQLERRM);
    END;
    --
    -- REQ. 5607 -
    -- 5 - REALIZA O RATEIO POR ALUNOS, SOMENTE SE EXISTIR TURMA
    -- E O ALUNO FOR REGULAR E PARA O PROCESSO DE CARGA HORARIA
    --
    V_POSICAO := 50;
    --
--    PRO_GERA_RATEIO(PI_PROXIMO_CICLO, PI_DT_COMPETENCIA, PI_NOM_PROCESSO, PI_NUM_SEQ_TURMA, PI_NUM_MATRICULA, PI_COD_TIPO_RUBRICA, PI_IND_CURSO_EXTENSAO, PI_IND_ENSINO_DISTANCIA, PI_COD_TIPO_ATUACAO, PI_COD_INSTITUICAO, PO_IND_ERRO, PO_MSG_RETORNO);
    --
--    IF PO_IND_ERRO <> '0' THEN
--      RAISE ERR_PREVISTO;
--    END IF;
    --
    IF PI_COMMIT = 'S' THEN
      COMMIT;
    END IF;
    --
  EXCEPTION
    WHEN ERR_PREVISTO THEN
      --
      V_SQLERRM := SQLERRM;
      --
      PO_IND_ERRO := TO_CHAR(V_POSICAO * -1);
      --
      CASE PO_IND_ERRO
        WHEN '-10' THEN
          PO_MSG_RETORNO := 'ERRO NO AJUSTE DAS HORAS - PRO_APURACAO_ALOCACAO : ' || PO_MSG_RETORNO;
        WHEN '-20' THEN
          PO_MSG_RETORNO := 'ERRO NA BUSCA DO CODIGO DA VERBA DO RH : ' || PO_MSG_RETORNO;
        WHEN '-30' THEN
          PO_MSG_RETORNO := 'ERRO NA BUSCA DO CODIGO DO CENTRO DE RESULTADO : ' || PO_MSG_RETORNO;
        WHEN '-40' THEN
          PO_MSG_RETORNO := 'ERRO AO INSERIR EM A_INTERFACE_PAGAMENTO : ' || PO_MSG_RETORNO;
        WHEN '-50' THEN
          PO_MSG_RETORNO := 'ERRO AO REALIZAR O RATEIO : ' || PO_MSG_RETORNO;
        ELSE
          PO_MSG_RETORNO := PO_MSG_RETORNO || ' - ERRO N O LISTADO : ' || V_SQLERRM;
      END CASE;
    --
      SEG.SEG_LOG_EXECUCAO('SIA.PRO_PAGAMENTO_PROFESSOR.GRAVA_ARQUIVO, IE: ' || PI_COD_INSTITUICAO, V_POSICAO, V_SQLERRM, V_TXT_PARAMETROS, PO_MSG_RETORNO);
      --
      IF PI_COMMIT = 'S'
      THEN
        ROLLBACK;
      END IF;
      --
    WHEN OTHERS THEN
      --
      V_SQLERRM := SQLERRM;
      --
      PO_IND_ERRO := TO_CHAR(V_POSICAO * -1);
      --
      CASE PO_IND_ERRO
        WHEN '-10' THEN
          PO_MSG_RETORNO := 'ERRO NO AJUSTE DAS HORAS - PRO_APURACAO_ALOCACAO : ' || PO_MSG_RETORNO;
        WHEN '-20' THEN
          PO_MSG_RETORNO := 'ERRO NA BUSCAR DO CODIGO DA VERBA DO RH : ' || V_SQLERRM;
        WHEN '-30' THEN
          PO_MSG_RETORNO := 'ERRO NA BUSCAR DO CODIGO DO CENTRO DE RESULTADO : ' || V_SQLERRM;
        WHEN '-40' THEN
          PO_MSG_RETORNO := 'ERRO AO INSERIR EM A_INTERFACE_PAGAMENTO : ' || V_SQLERRM;
        WHEN '-50' THEN
          PO_MSG_RETORNO := 'ERRO AO REALIZAR O RATEIO : ' || V_SQLERRM;
        ELSE
          PO_MSG_RETORNO := 'ERRO N O LISTADO : ' || V_SQLERRM;
      END CASE;
    --
      SEG.SEG_LOG_EXECUCAO('SIA.PRO_PAGAMENTO_PROFESSOR.GRAVA_ARQUIVO, IE: ' || PI_COD_INSTITUICAO, V_POSICAO, V_SQLERRM, V_TXT_PARAMETROS, ' Msg=> ' || PO_MSG_RETORNO);
      --
      IF PI_COMMIT = 'S'
      THEN
        ROLLBACK;
      END IF;
      --
  END GRAVA_ARQUIVO;